#!/bin/bash

# If ACTIONS_ID_TOKEN_REQUEST_URL is set, we're in GitHub Actions - skip Azure DevOps setup
if [ -n "${ACTIONS_ID_TOKEN_REQUEST_URL}" ]; then
  source "$(dirname $0)"/resolve-shim.sh
  NUGET_EXE="$(resolve_shim)"
  ${NUGET_EXE} "$@"
  exit $?
fi

source "$(dirname $0)"/auth-ado.sh
source "$(dirname $0)"/resolve-shim.sh

# Install artifact credential provider if it is not already installed
if [ ! -d "${HOME}/.nuget/plugins/netcore" ]; then
  wget -qO- https://aka.ms/install-artifacts-credprovider.sh | bash
fi

NUGET_EXE="$(resolve_shim)"
VSS_NUGET_ACCESSTOKEN="${ARTIFACTS_ACCESSTOKEN:-}" VSS_NUGET_URI_PREFIXES=REPLACE_WITH_AZURE_DEVOPS_NUGET_FEED_URL_PREFIX ${NUGET_EXE} "$@"